# This file was generated by GoReleaser. DO NOT EDIT.
# Maintainer: Bartek Pacia <barpac02@gmail.com>

pkgname='fhome'
pkgver=0.3.4
pkgrel=1
pkgdesc='Interact with smart home devices connected to F&Home'
url='https://github.com/bartekpacia/fhome'
arch=('aarch64' 'x86_64')
license=('MIT')
provides=('fhome')
conflicts=('fhome')
makedepends=('go' 'git')
source=("${pkgname}_${pkgver}.tar.gz::https://github.com/bartekpacia/fhome/releases/download/v0.3.4/fhome-0.3.4.tar.gz")
sha256sums=('05bdb2bfc1b65863f86932ac83fa74fc10fe2bb8ea7d00f0dc4108558e9a032f')
prepare() {
  cd "${pkgname}-${pkgver}"
  export GOPATH="${srcdir}"
  go mod download -modcacherw

}
build() {
  cd "${pkgname}-${pkgver}"
  export CGO_CPPFLAGS="${CPPFLAGS}"
  export CGO_CFLAGS="${CFLAGS}"
  export CGO_CXXFLAGS="${CXXFLAGS}"
  export CGO_LDFLAGS="${LDFLAGS}"
  export GOFLAGS="-buildmode=pie -trimpath -mod=readonly -modcacherw"
  go build -ldflags="-w -s -buildid='' -linkmode=external -X main.version=${pkgver}" .
  chmod +x ./fhome

}
package() {
  cd "$pkgname-$pkgver"
  # bin
  install -Dm755 fhome "${pkgdir}/usr/bin/fhome"

  # license
  install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/fhome/LICENSE"

  # completions
  ./fhome completion bash > completion_bash
  ./fhome completion zsh > completion_zsh
  install -Dm755 completion_bash "${pkgdir}/usr/share/bash-completion/completions/fhome"
  install -Dm755 completion_zsh "${pkgdir}/usr/share/zsh/site-functions/_fhome"

}
